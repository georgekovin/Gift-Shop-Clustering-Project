# <center> Сегментация клиентов онлайн магазина подарков


## Постановка задачи

<center> <img src=https://salesupnow.ru/storage/app/media/pipeople.png align="right" width="300"/> </center>

Маркетинг — неотъемлемая часть любого бизнеса. Для повышения прибыли компании важно понимать своего клиента, его пожелания и предпочтения. С появлением электронной коммерции, или онлайн-продаж, стало намного проще собирать данные о клиентах, анализировать их, находить закономерности и реализовывать маркетинговые кампании.

Большинство интернет-магазинов используют инструменты веб-аналитики, чтобы отслеживать просмотры страниц, количество и поведение посетителей и коэффициент отказов. Но отчёта из Google Analytics или аналогичной системы может быть недостаточно для полного понимания того, как клиенты взаимодействуют с сайтом. Компаниям важно иметь возможность быстро и точно реагировать на перемены в поведении клиентов, создавая инструменты, которые обнаруживают эти изменения практически в режиме реального времени.

Машинное обучение помогает поисковой системе анализировать огромное количество данных о посетителях платформы, узнавать модели поведения профессиональных покупателей, определять категорию клиентов (например, лояльные/перспективные/новички/спящие/ушедшие) и выбирать правильную стратегию взаимодействия с ними.

Стоит также отметить, что компании, использующие машинное обучение на своих платформах электронной коммерции, могут постоянно повышать эффективность бизнес-процессов: настраивать товарную выборку персонально для каждого покупателя и предлагать выгодную цену в соответствии с бюджетом клиента и т. д. Эта задача относится к категории построения рекомендательных систем, речь о которых пойдёт в следующем разделе нашего курса.

> Как правило, наборы данных для электронной коммерции являются частной собственностью и, следовательно, их трудно найти среди общедоступных данных. Однако [The UCI Machine Learning Repository](http://archive.ics.uci.edu/ml/index.php)  создал набор данных, содержащий фактические транзакции за 2010 и 2011 годы. С ним нам как раз и предлагается поработать в этом кейсе. 

> В нашем распоряжении будет набор данных, который содержит все транзакции, произошедшие в период с 01/12/2010 по 09/12/2011 для базирующейся в Великобритании компании, занимающейся онлайн-розничной торговлей. Компания в основном продает уникальные подарки на все случаи жизни. Многие клиенты компании являются оптовиками.


**Бизнес-задача:** произвести сегментацию существующих клиентов, проинтерпретировать эти сегменты и определить стратегию взаимодействия с ними.

**Техническая задача для вас как для специалиста в Data Science:** построить модель кластеризации клиентов на основе их покупательской способности, частоты заказов и срока давности последней покупки, определить профиль каждого из кластеров.

**Основные цели проекта:**
1. Произвести предобработку исходного набора данных о транзакциях.
2. Провести разведывательный анализ данных и выявить основные закономерности.
3. Сформировать набор данных о характеристиках каждого из уникальных клиентов.
4. Построить несколько моделей машинного обучения, решающих задачу кластеризации клиентов, определить количество кластеров и проинтерпретировать их.
5. Спроектировать процесс предсказания категории интересов клиента и протестировать вашу модель на новых клиентах.


## Данные и их описание

Данные представляют собой таблицу в формате CSV, в каждой строке которой содержится информация об уникальной транзакции.

Признаки, описывающие каждую транзакцию:

* InvoiceNo — номер счёта-фактуры (уникальный номинальный шестизначный номер, присваиваемый каждой транзакции; буква "C" в начале кода указывает на отмену транзакции);
* StockCode — код товара (уникальное пятизначное целое число, присваиваемое каждому отдельному товару);
* Description — название товара;
* Quantity — количество каждого товара за транзакцию;
* InvoiceDate — дата и время выставления счёта/проведения транзакции;
* UnitPrice — цена за единицу товара в фунтах стерлингов;
* CustomerID — идентификатор клиента (уникальный пятизначный номер, однозначно присваиваемый каждому клиенту);
* Country — название страны, в которой проживает клиент.


## Этапы решения задачи

Задача подразделяется на следующие этапы:

1. **Знакомство со структурой данных**

    Производится чтение данных, вывод основных статистических характеристик о них, чтобы понять, с какими данными мы имеем дело.

2. **Преобразование, очистка и анализ данных**

    Здесь из данных удаляются пропуски, дубликаты, создаются новые полезные признаки. Потом проводится разведывательный анализ данных с визуализацией, чтобы выявить закономерности в данных. Результат сохраняется в отдельный файл.

3. **Моделирование и оценка качества моделей**

    Создается сразу несколько моделей кластеризации и подбирается оптимальное количество кластеров на основе внутренних мер. Затем производится интерпретация результата с помощью визуализации и описания "портрета" получившихся кластеров.

4. **Выводы и оформление работы**

    Подводятся итоги проделанной работы и данные вместе с предсказанными кластерами заносятся в отдельный файл.


## Использованные инструменты

### *RFM-таблица*

Давайте познакомимся с очень популярным методом для анализа потребительской ценности под названием RFM. 

<center> <img src=https://miro.medium.com/max/1400/1*uYQjy9SUjW7iWHc2gGanQQ.png align="right" width="400"/> </center>

Метод заключается в группировке клиентов на основе следующих параметров:
* Recency (Давность) — давность последней покупки клиента;
* Frequency (Частота) — общее количество покупок клиента;
* Monetary Value (Денежная ценность) — сколько денег потратил клиент.

Суть RFM-анализа состоит в том, что мы разделяем всех клиентов на группы в зависимости от того, как давно они сделали последнюю покупку, как часто покупали и насколько большой была сумма их заказов. 

Например, вот так может выглядеть интерпретация кластеров для случая RF-сегментации (анализа на основе давности и частоты заказов клиента):

<img src=https://retailrocket.ru/wp-content/uploads/2017/06/rfm-1.png>

Задача маркетологов — вести клиента в зону лояльных.

Мы можем рассчитать RFM-характеристики для каждого из клиентов в нашем датасете и на их основе с помощью методов кластеризации построить подобные сегменты клиентов, привязанные к нашим данным.

### *Профиль кластеров*

Чтобы результаты было проще интерпретировать, давайте познакомимся с одним из способов визуализации профиля кластеров — **Radar Chart** (полярная диаграмма, или диаграмма паутины). Это графическое представление значений нескольких эквивалентных категорий в форме паутины.

Radar Chart часто используется при определении профиля кластеров. На концах паутины откладываются оси, соответствующие признакам, описывающим объекты. На каждой из осей для каждого кластера откладываются средние значения соответствующих характеристик. Соединив точки по осям, мы получаем многоугольник. 

Пример полярной диаграммы для задачи кластеризации учеников по интересам:

<img src=https://www.datanovia.com/en/wp-content/uploads/2020/12/radar-chart-in-r-customized-fmstb-radar-chart-1.png width=500>

На этой диаграмме мы видим визуализацию признаков для одного из кластеров. Видно, что ученики, принадлежащие этому кластеру, в большей степени увлекаются музыкой (Music), а в меньшей — программированием (Programm).

### *Библиотека Scikit-learn*

Были использованы классические методы кластеризации, реализованные в библиотеке `sklearn`. В частности - это метод К-средних (`Kmeans`), метод ЕМ-кластеризации на основе Гауссовой смеси (`GaussianMixture`), Аггломеративная Иерархическая кластеризация (`AgglomerativeClustering`) и метод DBSCAN (`DBSCAN`). Количество кластеров в первых трех было подобрано опираясь на внутреннюю меру "коэффициент силуэта" (`silhouette_score`).


## Результаты работы

В результате проделанной работы было выявленно **3** категории покупателей нашего онлайн-магазина, условно обозначенные следующим образом:

<center> <img src='plots\scatter_3d.png' width=400> </center>

0. **БЕДНЫЕ НОВИЧКИ** - не более чем 100 заказов, не ранее 130 дней назад и не дороже 2000 фунтов.
1. **БЕДНЫЕ СПЯЩИЕ** - разное количество заказов более 130 дней назад на сумму до 1000 фунтов.
2. **БОГАТЫЕ ЛОЯЛЬНЫЕ** - более 100 заказов на сумму более 2000 фунтов в разное время.

<center> <img src='plots\radar_chart.png' width=400> </center>

Группа **БЕДНЫЕ НОВИЧКИ** не делают значительного вклада в данные и имеют одинаково малые показатели по всем 3 признакам RFM. Группа **БЕДНЫЕ СПЯЩИЕ** делали заказы очень давно, но не часто и не принесли значительной прибыли магазину. А группа **БОГАТЫЕ ЛОЯЛЬНЫЕ** делают заказы часто и тратят много денег. 

Эти категории выявила модель `KMeans` со следующими параметрами:

```python
KMeans(n_clusters=3, n_init=10, random_state=42)
```

## Итоговые выводы

Данная работа была для меня непростой, но вполне посильной. Где-то я применил то, что уже хорошо знал, где-то пришлось подтянуть свои знания, а где-то в ходе работы я узнал много нового. Можно считать это хорошим опытом. Если вам не сложно оценить мой труд, можете поставить звездочку этому проекту.